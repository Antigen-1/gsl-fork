/* $Id$ */
/**
  zufall...
  */

#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#include "zuf.h"

/* It is crucial that m == n-273 mod 607 at all times;
 * For speed of execution, however, this is never enforced.
 * Instead is is set in the initializer: note 607-273=334
 * Note also that the state.u[607] is not initialized
 */
typedef struct {
    int n,m;
    double u[607];
} gsl_ran_zuf_randomState;

static void
gsl_ran_zuf_printState_p(gsl_ran_zuf_randomState *s)
{
    int n;
    printf("%d, %d,  {\n",s->n,s->m);
    for (n=0; n<607; ++n) {
	/* The numbers are only accurate to 24 bits, but
	 * that still requires 24 digits of precison to
	 * represent */
	printf("%.24lf,\n",s->u[n]);
    }
    printf("}\n");
}


inline double gsl_ran_zuf_uniform_wstate(void *vState)
{
    double t;
    gsl_ran_zuf_randomState *theState;
    theState = (gsl_ran_zuf_randomState *)vState;

    t = theState->u[theState->m] + theState->u[theState->n];
    while (t>1.0) t -= 1.0;     /* same as floor() */
    theState->u[theState->n] = t;
    if (++theState->n >= 607) theState->n=0;
    if (++theState->m >= 607) theState->m=0;
    
    return t;
}    

#define gsl_ran_zuf_RANDMAX 2147483647.0
inline unsigned long gsl_ran_zuf_random_wstate(void *vState)
{
    return (unsigned long)(gsl_ran_zuf_uniform_wstate(vState)*gsl_ran_zuf_RANDMAX);
}
double gsl_ran_zuf_max()
{
    return gsl_ran_zuf_RANDMAX;
}
void gsl_ran_zuf_seed_wstate(void *vState, int seed)
{
    /* A very elaborate seeding procedure is provided with the
     * zufall package; this is virtually a copy of that procedure */
    
    /* Initialized data */

    int kl = 9373;
    int ij = 1802;

    /* Local variables */
    int i, j, k, l, m;
    double s, t;
    int ii, jj;

    gsl_ran_zuf_randomState *theState;
    theState = (gsl_ran_zuf_randomState *)vState;

    /* It is crucial that m == n-273 mod 607 at all times;
     * For speed of execution, however, this is never enforced.
     * Instead is is set here (and in the state initializer):
     * note 607-273=334
     */
    theState->n=0;
    theState->m=334;
    
/*  generates initial seed buffer by linear congruential */
/*  method. Taken from Marsaglia, FSU report FSU-SCRI-87-50 */
/*  variable seed should be 0 < seed <31328 */


    if (seed != 0) {
	ij = seed;
    }

    i = ij / 177 % 177 + 2;
    j = ij % 177 + 2;
    k = kl / 169 % 178 + 1;
    l = kl % 169;
    for (ii = 0; ii < 607; ++ii) {
	s = 0.;
	t = .5;
	/* 24 bits?? */
	for (jj = 1; jj <= 24; ++jj) {
	    m = i * j % 179 * k % 179;
	    i = j;
	    j = k;
	    k = m;
	    l = (l * 53 + 1) % 169;
	    if (l * m % 64 >= 32) {
		s += t;
	    }
	    t *= 0.5;
	}
	theState->u[ii] = s;
    }
} 

/* It is crucial that m == n-273 mod 607 at all times;
 * For speed of execution, however, this is never enforced.
 * Instead is is set in the initializer: note 607-273=334.
 * Currently, state.u[607] is not initialized to anything special
 */
static gsl_ran_zuf_randomState state = {
    0, 334,  {
	0.827898561954498291015625,
	0.695468783378601074218750,
	0.401741147041320800781250,
	0.380188405513763427734375,
	0.268286943435668945312500,
	0.378011465072631835937500,
	0.695020198822021484375000,
	0.451325833797454833984375,
	0.525309979915618896484375,
	0.843417644500732421875000,
	0.834219455718994140625000,
	0.211159467697143554687500,
	0.137740015983581542968750,
	0.413219213485717773437500,
	0.446846604347229003906250,
	0.974340617656707763671875,
	0.949570775032043457031250,
	0.198869943618774414062500,
	0.058722078800201416015625,
	0.063228666782379150390625,
	0.224625229835510253906250,
	0.352785110473632812500000,
	0.670800983905792236328125,
	0.619171380996704101562500,
	0.247944891452789306640625,
	0.230671048164367675781250,
	0.512166142463684082031250,
	0.290302872657775878906250,
	0.584794580936431884765625,
	0.428217709064483642578125,
	0.532860815525054931640625,
	0.090281963348388671875000,
	0.721004962921142578125000,
	0.528556883335113525390625,
	0.073709189891815185546875,
	0.411429405212402343750000,
	0.930899679660797119140625,
	0.991667330265045166015625,
	0.880157470703125000000000,
	0.368369400501251220703125,
	0.371502280235290527343750,
	0.918036699295043945312500,
	0.540256142616271972656250,
	0.115842759609222412109375,
	0.868069946765899658203125,
	0.461977958679199218750000,
	0.040597558021545410156250,
	0.653819441795349121093750,
	0.816464781761169433593750,
	0.497766613960266113281250,
	0.037932515144348144531250,
	0.730597496032714843750000,
	0.305616796016693115234375,
	0.137825846672058105468750,
	0.547249555587768554687500,
	0.293922543525695800781250,
	0.911009907722473144531250,
	0.663942992687225341796875,
	0.976376533508300781250000,
	0.034264922142028808593750,
	0.320196688175201416015625,
	0.167754113674163818359375,
	0.288185119628906250000000,
	0.911097049713134765625000,
	0.620482802391052246093750,
	0.698736429214477539062500,
	0.988991498947143554687500,
	0.518355786800384521484375,
	0.740764558315277099609375,
	0.345977485179901123046875,
	0.747629761695861816406250,
	0.648112177848815917968750,
	0.421344101428985595703125,
	0.017758071422576904296875,
	0.377418160438537597656250,
	0.968037068843841552734375,
	0.786617517471313476562500,
	0.234264075756072998046875,
	0.394847273826599121093750,
	0.059508562088012695312500,
	0.032077848911285400390625,
	0.849929988384246826171875,
	0.569405198097229003906250,
	0.959247410297393798828125,
	0.930423676967620849609375,
	0.619320511817932128906250,
	0.238324403762817382812500,
	0.540687263011932373046875,
	0.193101286888122558593750,
	0.824399769306182861328125,
	0.603320896625518798828125,
	0.829975843429565429687500,
	0.969272077083587646484375,
	0.700277686119079589843750,
	0.877559244632720947265625,
	0.743950128555297851562500,
	0.877819120883941650390625,
	0.982643306255340576171875,
	0.286858677864074707031250,
	0.289121150970458984375000,
	0.151783823966979980468750,
	0.589101850986480712890625,
	0.664380133152008056640625,
	0.826718449592590332031250,
	0.609717428684234619140625,
	0.095305383205413818359375,
	0.487632155418395996093750,
	0.974145352840423583984375,
	0.721832931041717529296875,
	0.197595238685607910156250,
	0.129095077514648437500000,
	0.948216259479522705078125,
	0.029256045818328857421875,
	0.040000855922698974609375,
	0.059655845165252685546875,
	0.656647682189941406250000,
	0.518652915954589843750000,
	0.279971241950988769531250,
	0.888580739498138427734375,
	0.140873253345489501953125,
	0.034365832805633544921875,
	0.591572225093841552734375,
	0.063066184520721435546875,
	0.234525680541992187500000,
	0.931285500526428222656250,
	0.957178056240081787109375,
	0.222695767879486083984375,
	0.065938115119934082031250,
	0.622877657413482666015625,
	0.505442500114440917968750,
	0.504455626010894775390625,
	0.257516086101531982421875,
	0.255766928195953369140625,
	0.129902064800262451171875,
	0.160978376865386962890625,
	0.048197984695434570312500,
	0.504561126232147216796875,
	0.220480084419250488281250,
	0.189552664756774902343750,
	0.577961504459381103515625,
	0.923492670059204101562500,
	0.380502521991729736328125,
	0.091842830181121826171875,
	0.721169829368591308593750,
	0.348646700382232666015625,
	0.570665001869201660156250,
	0.094890952110290527343750,
	0.314051389694213867187500,
	0.728855431079864501953125,
	0.806575000286102294921875,
	0.489438235759735107421875,
	0.674323618412017822265625,
	0.422150552272796630859375,
	0.079043388366699218750000,
	0.687323331832885742187500,
	0.232603847980499267578125,
	0.071396350860595703125000,
	0.760259866714477539062500,
	0.621068596839904785156250,
	0.337423264980316162109375,
	0.943841993808746337890625,
	0.523004233837127685546875,
	0.066821753978729248046875,
	0.150847136974334716796875,
	0.602071225643157958984375,
	0.228609085083007812500000,
	0.764195442199707031250000,
	0.220136344432830810546875,
	0.603348493576049804687500,
	0.388141512870788574218750,
	0.816310048103332519531250,
	0.569958925247192382812500,
	0.529453575611114501953125,
	0.662763833999633789062500,
	0.348710060119628906250000,
	0.665105819702148437500000,
	0.452950656414031982421875,
	0.565112709999084472656250,
	0.926982760429382324218750,
	0.024188995361328125000000,
	0.324169218540191650390625,
	0.028761565685272216796875,
	0.949902176856994628906250,
	0.921517372131347656250000,
	0.796830236911773681640625,
	0.742448508739471435546875,
	0.998762547969818115234375,
	0.687695145606994628906250,
	0.067097961902618408203125,
	0.072216510772705078125000,
	0.090178787708282470703125,
	0.075158536434173583984375,
	0.035151898860931396484375,
	0.438955008983612060546875,
	0.836122274398803710937500,
	0.640066266059875488281250,
	0.278463959693908691406250,
	0.075503587722778320312500,
	0.059866905212402343750000,
	0.582768797874450683593750,
	0.113367557525634765625000,
	0.119597971439361572265625,
	0.304714083671569824218750,
	0.321399390697479248046875,
	0.475040316581726074218750,
	0.744517505168914794921875,
	0.635783135890960693359375,
	0.968276619911193847656250,
	0.005594015121459960937500,
	0.609158158302307128906250,
	0.298914313316345214843750,
	0.339186668395996093750000,
	0.079545378684997558593750,
	0.882914662361145019531250,
	0.679204523563385009765625,
	0.393871784210205078125000,
	0.218332529067993164062500,
	0.825604915618896484375000,
	0.957678854465484619140625,
	0.739182412624359130859375,
	0.989978969097137451171875,
	0.810795187950134277343750,
	0.527739703655242919921875,
	0.148208677768707275390625,
	0.788792729377746582031250,
	0.345373511314392089843750,
	0.071821391582489013671875,
	0.037735939025878906250000,
	0.797509253025054931640625,
	0.024541616439819335937500,
	0.112333476543426513671875,
	0.436154305934906005859375,
	0.014013826847076416015625,
	0.590466618537902832031250,
	0.496974229812622070312500,
	0.232491910457611083984375,
	0.289887368679046630859375,
	0.407925009727478027343750,
	0.691441833972930908203125,
	0.281776010990142822265625,
	0.566277921199798583984375,
	0.677857220172882080078125,
	0.136285424232482910156250,
	0.903110146522521972656250,
	0.879199326038360595703125,
	0.836379110813140869140625,
	0.564739346504211425781250,
	0.943207502365112304687500,
	0.744745552539825439453125,
	0.090890347957611083984375,
	0.942970454692840576171875,
	0.341103613376617431640625,
	0.496616125106811523437500,
	0.895605087280273437500000,
	0.460501372814178466796875,
	0.576471984386444091796875,
	0.874121665954589843750000,
	0.156742572784423828125000,
	0.800080835819244384765625,
	0.703875184059143066406250,
	0.775312006473541259765625,
	0.425525367259979248046875,
	0.820381999015808105468750,
	0.636281967163085937500000,
	0.322492957115173339843750,
	0.482814133167266845703125,
	0.974965274333953857421875,
	0.771181702613830566406250,
	0.391979336738586425781250,
	0.290567040443420410156250,
	0.261686444282531738281250,
	0.137054443359375000000000,
	0.464255750179290771484375,
	0.652884304523468017578125,
	0.985382318496704101562500,
	0.031450510025024414062500,
	0.045057952404022216796875,
	0.037842094898223876953125,
	0.977026998996734619140625,
	0.506681025028228759765625,
	0.512774705886840820312500,
	0.723231017589569091796875,
	0.489749908447265625000000,
	0.956825554370880126953125,
	0.129044234752655029296875,
	0.779450476169586181640625,
	0.082997858524322509765625,
	0.587928235530853271484375,
	0.386607408523559570312500,
	0.266911089420318603515625,
	0.865645349025726318359375,
	0.969926178455352783203125,
	0.601777672767639160156250,
	0.484002590179443359375000,
	0.345324993133544921875000,
	0.373895585536956787109375,
	0.132761299610137939453125,
	0.833175182342529296875000,
	0.570476293563842773437500,
	0.851157724857330322265625,
	0.458662986755371093750000,
	0.256504118442535400390625,
	0.962440788745880126953125,
	0.592151761054992675781250,
	0.817906260490417480468750,
	0.648597538471221923828125,
	0.704375565052032470703125,
	0.673156738281250000000000,
	0.789520919322967529296875,
	0.925621271133422851562500,
	0.592690229415893554687500,
	0.877212703227996826171875,
	0.370187819004058837890625,
	0.733531832695007324218750,
	0.862472772598266601562500,
	0.679517745971679687500000,
	0.810956954956054687500000,
	0.368088603019714355468750,
	0.634109437465667724609375,
	0.132039368152618408203125,
	0.251252710819244384765625,
	0.937498986721038818359375,
	0.271354973316192626953125,
	0.197721779346466064453125,
	0.941656172275543212890625,
	0.646163940429687500000000,
	0.563354074954986572265625,
	0.604189515113830566406250,
	0.959664881229400634765625,
	0.678815305233001708984375,
	0.507712841033935546875000,
	0.950247704982757568359375,
	0.417832374572753906250000,
	0.686181128025054931640625,
	0.724154651165008544921875,
	0.725869476795196533203125,
	0.217403233051300048828125,
	0.545180320739746093750000,
	0.623225331306457519531250,
	0.463690578937530517578125,
	0.588146686553955078125000,
	0.378945112228393554687500,
	0.802219629287719726562500,
	0.830246090888977050781250,
	0.442642331123352050781250,
	0.277560949325561523437500,
	0.450541138648986816406250,
	0.778573989868164062500000,
	0.795515835285186767578125,
	0.421970129013061523437500,
	0.195174992084503173828125,
	0.750631988048553466796875,
	0.259534299373626708984375,
	0.399675965309143066406250,
	0.375932812690734863281250,
	0.606434047222137451171875,
	0.141019523143768310546875,
	0.496213436126708984375000,
	0.605063676834106445312500,
	0.807953000068664550781250,
	0.698958516120910644531250,
	0.491252422332763671875000,
	0.994908869266510009765625,
	0.766311347484588623046875,
	0.296414196491241455078125,
	0.370615184307098388671875,
	0.878834426403045654296875,
	0.844217896461486816406250,
	0.741009116172790527343750,
        0.889712572097778320312500,
        0.168003141880035400390625,
        0.251551449298858642578125,
        0.573615193367004394531250,
        0.379140913486480712890625,
        0.198118925094604492187500,
        0.637260615825653076171875,
        0.727722644805908203125000,
        0.086925864219665527343750,
        0.139547348022460937500000,
        0.733063697814941406250000,
        0.182457864284515380859375,
        0.249983668327331542968750,
        0.700513899326324462890625,
        0.886549353599548339843750,
        0.443685114383697509765625,
        0.279594957828521728515625,
        0.470719516277313232421875,
        0.601661264896392822265625,
        0.110557913780212402343750,
        0.709197521209716796875000,
        0.501350343227386474609375,
        0.234399974346160888671875,
        0.626558601856231689453125,
        0.927912056446075439453125,
        0.317869603633880615234375,
        0.377876460552215576171875,
        0.510184526443481445312500,
        0.613574385643005371093750,
        0.285226881504058837890625,
        0.174632668495178222656250,
        0.002398371696472167968750,
        0.407861888408660888671875,
        0.623618364334106445312500,
        0.202660202980041503906250,
        0.924907028675079345703125,
        0.399245083332061767578125,
        0.293244302272796630859375,
        0.244884192943572998046875,
        0.435749351978302001953125,
        0.085292100906372070312500,
        0.040041089057922363281250,
        0.110897362232208251953125,
        0.525961160659790039062500,
        0.612120747566223144531250,
        0.948792338371276855468750,
        0.457808375358581542968750,
        0.777592003345489501953125,
        0.383232235908508300781250,
        0.628903627395629882812500,
        0.826272428035736083984375,
        0.312333524227142333984375,
        0.117260456085205078125000,
        0.246432602405548095703125,
        0.354427874088287353515625,
        0.505283355712890625000000,
        0.361267030239105224609375,
        0.705040693283081054687500,
        0.970005750656127929687500,
        0.725051343441009521484375,
        0.196374535560607910156250,
        0.991816639900207519531250,
        0.985874414443969726562500,
        0.001545727252960205078125,
        0.758883237838745117187500,
        0.432352781295776367187500,
        0.840207993984222412109375,
        0.094916820526123046875000,
        0.434001088142395019531250,
        0.436532258987426757812500,
        0.399569869041442871093750,
        0.363754272460937500000000,
        0.599626958370208740234375,
        0.234083831310272216796875,
        0.707917392253875732421875,
        0.012043654918670654296875,
        0.843599438667297363281250,
        0.513161003589630126953125,
        0.287408888339996337890625,
        0.652951240539550781250000,
        0.678017556667327880859375,
        0.532736003398895263671875,
        0.421488881111145019531250,
        0.601568758487701416015625,
        0.659664511680603027343750,
        0.070624649524688720703125,
        0.748565137386322021484375,
        0.116162359714508056640625,
        0.337753236293792724609375,
        0.820563375949859619140625,
        0.112244665622711181640625,
        0.641920268535614013671875,
        0.214066863059997558593750,
        0.999698102474212646484375,
        0.367538273334503173828125,
        0.892373859882354736328125,
        0.140963315963745117187500,
        0.976315498352050781250000,
        0.524798274040222167968750,
        0.734008550643920898437500,
        0.212659418582916259765625,
        0.843382179737091064453125,
        0.292556047439575195312500,
        0.231358230113983154296875,
        0.251893937587738037109375,
        0.277932941913604736328125,
        0.352174401283264160156250,
        0.008343815803527832031250,
        0.445740222930908203125000,
        0.337983071804046630859375,
        0.238932788372039794921875,
        0.865822672843933105468750,
        0.162242889404296875000000,
        0.652844727039337158203125,
        0.782112419605255126953125,
        0.417882084846496582031250,
        0.806266546249389648437500,
        0.057881295680999755859375,
        0.220004677772521972656250,
        0.399639189243316650390625,
        0.124796152114868164062500,
        0.162417113780975341796875,
        0.576190650463104248046875,
        0.017066717147827148437500,
        0.457384169101715087890625,
        0.599005281925201416015625,
        0.847487688064575195312500,
        0.400533974170684814453125,
        0.526205837726593017578125,
        0.758900225162506103515625,
        0.158131539821624755859375,
        0.647065699100494384765625,
        0.858787953853607177734375,
        0.885671555995941162109375,
        0.708248019218444824218750,
        0.663547694683074951171875,
        0.356032907962799072265625,
        0.814933955669403076171875,
        0.410018503665924072265625,
        0.121745645999908447265625,
        0.385281085968017578125000,
        0.463265657424926757812500,
        0.569332778453826904296875,
        0.847737371921539306640625,
        0.418898105621337890625000,
        0.084066092967987060546875,
        0.811895310878753662109375,
        0.006354391574859619140625,
        0.917639374732971191406250,
        0.437518000602722167968750,
        0.115320146083831787109375,
        0.969247341156005859375000,
        0.519629120826721191406250,
        0.358496427536010742187500,
        0.971258580684661865234375,
        0.085071563720703125000000,
        0.137766420841217041015625,
        0.867447614669799804687500,
        0.973415434360504150390625,
        0.369589805603027343750000,
        0.715387225151062011718750,
        0.341524541378021240234375,
        0.074932098388671875000000,
        0.992406964302062988281250,
        0.763563692569732666015625,
        0.242459237575531005859375,
        0.052926898002624511718750,
        0.670779585838317871093750,
        0.644028544425964355468750,
        0.622614383697509765625000,
        0.960219025611877441406250,
        0.964131295680999755859375,
        0.394320785999298095703125,
        0.460632681846618652343750,
        0.313314795494079589843750,
        0.755726337432861328125000,
        0.153349876403808593750000,
        0.347799301147460937500000,
        0.498547077178955078125000,
        0.248086631298065185546875,
        0.455775141716003417968750,
        0.475483834743499755859375,
        0.638718605041503906250000,
        0.593961536884307861328125,
        0.413102209568023681640625,
        0.747862875461578369140625,
        0.443849921226501464843750,
        0.067268013954162597656250,
        0.156802237033843994140625,
        0.804092466831207275390625,
        0.866229534149169921875000,
        0.202770173549652099609375,
        0.913945555686950683593750,
        0.724596023559570312500000,
        0.235335111618041992187500,
        0.490574479103088378906250,
        0.840523540973663330078125,
        0.900583148002624511718750,
        0.109993457794189453125000,
        0.784400701522827148437500,
        0.328029453754425048828125,
        0.259566426277160644531250,
        0.090365409851074218750000,
        0.023017644882202148437500,
        0.541395783424377441406250,
        0.775177597999572753906250,
        0.445475518703460693359375,
        0.262283504009246826171875,
        0.927000522613525390625000,
        0.607758283615112304687500,
        0.171627104282379150390625,
        0.382846891880035400390625,
        0.877095043659210205078125,
        0.412084937095642089843750,
        0.944696307182312011718750,
        0.826598703861236572265625,
        0.893547713756561279296875,
        0.082945466041564941406250,
        0.051153838634490966796875,
        0.046707808971405029296875,
        0.173998653888702392578125,
        0.957052648067474365234375,
        0.497935831546783447265625,
        0.929779708385467529296875,
        0.037786722183227539062500,
        0.322284758090972900390625,
        0.538559377193450927734375,
        0.512860655784606933593750,
        0.604542016983032226562500,
        0.556724190711975097656250,
        0.505425035953521728515625,
        0.848001241683959960937500,
        0.425061941146850585937500,
        0.198946475982666015625000,
        0.546216368675231933593750,
        0.351132571697235107421875,
        0.574405133724212646484375,
        0.449113547801971435546875
    }
};

#include "zuf-state.c"

/* thats all... */
